\doxysection{Ans\+Service\+Registry\+Servant.\+h}
\hypertarget{_ans_service_registry_servant_8h_source}{}\label{_ans_service_registry_servant_8h_source}\index{commonfiles20.1/PublicItf/AnsServiceRegistryServant.h@{commonfiles20.1/PublicItf/AnsServiceRegistryServant.h}}
\mbox{\hyperlink{_ans_service_registry_servant_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (C)\ 2009\ ANSYS,\ Inc.\ and\ its\ subsidiaries.\ \ All\ Rights\ Reserved.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ \$LastChangedDate\$}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ \$LastChangedRevision\$}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ \$LastChangedBy\$}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ \_AnsServiceRegistryServant\_h\_}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ \_AnsServiceRegistryServant\_h\_}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_ans_i_service_registry_8h}{AnsIServiceRegistry.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_ans_interface_servant_8h}{AnsInterfaceServant.h}}"{}}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_ans}{Ans}}\ \{}
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }Rpc\ \{}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant}{ServiceRegistryServant}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base}{InterfaceServantBase}}<ServiceRegistryServant>,\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_connection_observer}{IConnectionObserver}}}
\DoxyCodeLine{00021\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keyword}{typedef}\ std::map<RpcHandle,\ std::string>\ ProviderConnectionMap;}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{typedef}\ ProviderConnectionMap::iterator\ ProviderConnectionMapIterator;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_aebd0c9f1e49c67563bca4bc9c92523f5}{ServiceRegistryServant}}(\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry}{IServiceRegistry}}\&\ registry)\ :}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base}{InterfaceServantBase}}<\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant}{ServiceRegistryServant}}>(\textcolor{stringliteral}{"{}ServiceRegistry"{}}),\ \_registry(registry)}
\DoxyCodeLine{00028\ \ \ \ \ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base_a0af5263279424e4f41230df87ac33eca}{RegisterMethod}}(\textcolor{stringliteral}{"{}GetAllServiceProviders"{}},\ \&\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a660c6807149405e5ee406a98e6c58a09}{ServiceRegistryServant::GetAllServiceProviders}});}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base_a0af5263279424e4f41230df87ac33eca}{RegisterMethod}}(\textcolor{stringliteral}{"{}GetServiceProvider"{}},\ \&\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_ab38cecd65787975db2c43d712f0fc8b8}{ServiceRegistryServant::GetServiceProvider}});}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base_a0af5263279424e4f41230df87ac33eca}{RegisterMethod}}(\textcolor{stringliteral}{"{}RegisterServiceProvider"{}},\ \&\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a74e71fb13c504ff7651cc22b943e7968}{ServiceRegistryServant::RegisterServiceProvider}});}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_interface_servant_base_a0af5263279424e4f41230df87ac33eca}{RegisterMethod}}(\textcolor{stringliteral}{"{}UnregisterServiceProvider"{}},\ \&\mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a33b170b18ab63b7e4651e1db508f7e0b}{ServiceRegistryServant::UnregisterServiceProvider}});}
\DoxyCodeLine{00033\ \ \ \ \ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a660c6807149405e5ee406a98e6c58a09}{GetAllServiceProviders}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_request}{Request}}\&\ request,\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_response}{Response}}\&\ response)}
\DoxyCodeLine{00036\ \ \ \ \ \{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<ProviderHandle>\&\ serviceProviders\ =\ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_afacd85811eff3b94834036a80d672416}{GetAllServiceProviders}}();}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_array_arg}{MessageArrayArg<std::string>}}\&\ names\ =\ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a66a0e739d869493fc262d92495e418cd}{NewArrayArg}}<std::string>();}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_array_arg}{MessageArrayArg<std::string>}}\&\ hosts\ =\ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a66a0e739d869493fc262d92495e418cd}{NewArrayArg}}<std::string>();}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_array_arg}{MessageArrayArg<RpcInt32>}}\&\ ports\ =\ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a66a0e739d869493fc262d92495e418cd}{NewArrayArg}}<\mbox{\hyperlink{ansrpc_8h_a4d9b7ea3ef70d58483ec63c1be5a08cb}{RpcInt32}}>();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::vector<ProviderHandle>::const\_iterator\ it\ =\ serviceProviders.begin();\ it\ !=\ serviceProviders.end();\ it++)}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ names.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_array_arg_a38a418f483b80a03f9273ad773a89dd0}{Value}}.push\_back((*it).Name);}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ hosts.Value.push\_back((*it).Host);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ ports.Value.push\_back((*it).Port);}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a6295e3778642fcb745af0d3417b58d4b}{HasServiceProvider}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_request}{Request}}\&\ request,\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_response}{Response}}\&\ response)}
\DoxyCodeLine{00052\ \ \ \ \ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ std::string\ serviceProviderName\ =\ request.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_af014813a4b77706443b4a4503b159992}{GetArg}}<std::string>(0);}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a4ffa106aae901c5e3abd0229c6cbf532}{AddArg}}<\mbox{\hyperlink{ansrpc_8h_ad3d8e58a2d97f8ab41f3c956d5623a65}{RpcByte}}>(\_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_a1906ae371cb6a3340d096f2ecd92dc21}{HasServiceProvider}}(serviceProviderName));}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_a1906ae371cb6a3340d096f2ecd92dc21}{HasServiceProvider}}(serviceProviderName);}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_ab38cecd65787975db2c43d712f0fc8b8}{GetServiceProvider}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_request}{Request}}\&\ request,\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_response}{Response}}\&\ response)}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ std::string\ serviceProviderName\ =\ request.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_af014813a4b77706443b4a4503b159992}{GetArg}}<std::string>(0);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle}{ProviderHandle}}\ serviceProvider\ =\ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_af5e91d00af5c13af58a7d9f8d409068c}{GetServiceProvider}}(serviceProviderName);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a4ffa106aae901c5e3abd0229c6cbf532}{AddArg}}<std::string>(serviceProvider.Name);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a4ffa106aae901c5e3abd0229c6cbf532}{AddArg}}<std::string>(serviceProvider.Host);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ response.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_a4ffa106aae901c5e3abd0229c6cbf532}{AddArg}}<\mbox{\hyperlink{ansrpc_8h_a4d9b7ea3ef70d58483ec63c1be5a08cb}{RpcInt32}}>(serviceProvider.Port);}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a74e71fb13c504ff7651cc22b943e7968}{RegisterServiceProvider}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_request}{Request}}\&\ request,\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_response}{Response}}\&\ response)}
\DoxyCodeLine{00068\ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle}{ProviderHandle}}\ serviceProvider;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_arg_iterator}{MessageArgIterator}}\ args(request);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ serviceProvider.\mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle_adc852f586959ce13117d737cf3f14899}{Name}}\ =\ args.GetNextArg<std::string>();}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ serviceProvider.\mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle_a9c4801d09d1e1b363caa3f06c56a3c9c}{Host}}\ =\ args.GetNextArg<std::string>();}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ serviceProvider.\mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle_a91b1a1342df7fe9e51fb5dfc4999dfe8}{Port}}\ =\ args.GetNextArg<\mbox{\hyperlink{ansrpc_8h_a4d9b7ea3ef70d58483ec63c1be5a08cb}{RpcInt32}}>();}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_a2a1ecae4868c74e8130fe69d2f3920ed}{RegisterServiceProvider}}(serviceProvider);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \_providerConnectionMap[request.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_request_a3f848fa731b0c24ec20bfa3a7902a0b4}{GetChannel}}()]\ =\ serviceProvider.\mbox{\hyperlink{struct_ans_1_1_rpc_1_1_provider_handle_adc852f586959ce13117d737cf3f14899}{Name}};}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_a33b170b18ab63b7e4651e1db508f7e0b}{UnregisterServiceProvider}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_request}{Request}}\&\ request,\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_response}{Response}}\&\ response)}
\DoxyCodeLine{00079\ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ std::string\ serviceProviderName\ =\ request.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_message_af014813a4b77706443b4a4503b159992}{GetArg}}<std::string>(0);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_a586d783d4fe16fe7ce64908d53dd3bbd}{UnregisterServiceProvider}}(serviceProviderName);}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ ProviderConnectionMapIterator\ it\ =\ \_providerConnectionMap.find(request.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_request_a3f848fa731b0c24ec20bfa3a7902a0b4}{GetChannel}}());}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ \_providerConnectionMap.end())}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \_providerConnectionMap.erase(it);}
\DoxyCodeLine{00086\ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_accfa3c2fdd7fc34a4eaab2b1eae36ad6}{OnConnectionOpened}}(\mbox{\hyperlink{ansrpc_8h_aa6f6cd93cb32899541b3ba2ae528e48e}{RpcHandle}}\ channel)}
\DoxyCodeLine{00089\ \ \ \ \ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_service_registry_servant_aaabffb9b343d49698fcf661611af8cb0}{OnConnectionClosed}}(\mbox{\hyperlink{ansrpc_8h_aa6f6cd93cb32899541b3ba2ae528e48e}{RpcHandle}}\ channel)}
\DoxyCodeLine{00094\ \ \ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ ProviderConnectionMapIterator\ it\ =\ \_providerConnectionMap.find(channel);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ \_providerConnectionMap.end())}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \_registry.\mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry_a586d783d4fe16fe7ce64908d53dd3bbd}{UnregisterServiceProvider}}((*it).second);}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \_providerConnectionMap.erase(it);}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{class_ans_1_1_rpc_1_1_i_service_registry}{IServiceRegistry}}\&\ \_registry;}
\DoxyCodeLine{00105\ \ \ \ \ ProviderConnectionMap\ \_providerConnectionMap;}
\DoxyCodeLine{00106\ \};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \}\}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
